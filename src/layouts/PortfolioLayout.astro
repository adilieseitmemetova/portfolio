---
import Project from "../components/Project.astro";
import SiteHeader from "../components/SiteHeader.astro";

import "../styles/portfolio.css";

type Study = {
	title: string;
	description: string;
};

const { t, currentLang = "en" } = Astro.props;
const studies: Study[] = Array.isArray((t as any).studies)
	? ((t as any).studies as Study[])
	: [];
const projects = Array.isArray((t as any).projects) ? (t as any).projects : [];
---

<!doctype html>
<html lang={currentLang}>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="icon" type="image/svg+xml" href="/favicon.png" />
		<meta name="generator" content={Astro.generator} />
		<title>{t.metaTitle}</title>
		<meta name="description" content={t.metaDescription} />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Imperial+Script&display=swap"
			rel="stylesheet"
		/>
		<script is:inline>
			if ("scrollRestoration" in history) {
				history.scrollRestoration = "manual";
			}
			window.addEventListener("load", () => {
				window.scrollTo(0, 0);

				const codeEl = document.querySelector(".hero-subtitle-code");
				if (!codeEl) return;

				const prefersReducedMotion =
					window.matchMedia &&
					window.matchMedia("(prefers-reduced-motion: reduce)")
						.matches;

				if (prefersReducedMotion) return;

				const fullText = (codeEl.textContent || "").trim();
				codeEl.textContent = "";

				let index = 0;
				const typeSpeed = 90;
				const startDelay = 1800;
				const pauseBeforeDot = 620;
				const dotIndex =
					fullText.lastIndexOf(".") >= 0
						? fullText.lastIndexOf(".") + 1
						: -1;

				const typeNext = () => {
					if (index > fullText.length) return;
					codeEl.textContent = fullText.slice(0, index);
					index += 1;
					if (index <= fullText.length) {
						const isBeforeDot =
							dotIndex !== -1 && index === dotIndex;
						const delay = isBeforeDot ? pauseBeforeDot : typeSpeed;
						setTimeout(typeNext, delay);
					}
				};

				setTimeout(typeNext, startDelay);
			});
		</script>
	</head>
	<body>
		<SiteHeader
			logoLabel={t.logo}
			currentLang={currentLang}
			nav={{
				home: t.navHome,
				projects: t.navProjects,
				about: t.navAbout,
				contact: t.navContact,
				languageLabel: t.languageLabel,
			}}
		/>

		<main id="home">
			<section class="hero">
				<div class="container hero-content">
					<div class="hero-inner">
						<span class="hero-badge">{t.heroBadge}</span>
						<h1 class="hero-title">{t.heroTitle}</h1>
						<p class="hero-subtitle">
							<span class="hero-subtitle-main">
								{t.heroSubtitleMain}
							</span>
							<span class="hero-subtitle-connector">
								{t.heroSubtitleConnector}
							</span>
							<span class="hero-subtitle-code">
								{t.heroSubtitleCode}
							</span>
						</p>
						<p class="hero-location">{t.heroLocation}</p>
						<div class="hero-actions">
							<a href="#projects" class="btn primary">
								{t.heroPrimaryCta}
							</a>
							<a href="#contact" class="btn secondary">
								{t.heroSecondaryCta}
							</a>
						</div>
					</div>
				</div>
			</section>

			<section id="projects" class="project-showcase">
				{
					projects.map((project: any) => (
						<Project
							title={project.title}
							dates={project.dates}
							description={project.description}
							tags={project.tags}
							imageSrc={project.imageSrc}
							imageAlt={project.imageAlt}
						/>
					))
				}
			</section>

			<section id="about" class="section">
				<div class="container">
					<h2 class="section-title">{t.aboutTitle}</h2>
					<p class="section-text">{t.aboutText}</p>
					{
						studies.length > 0 && (
							<div class="about-studies">
								<h3 class="about-subtitle">{t.studiesTitle}</h3>
								<ul class="about-studies-list">
									{studies.map((item: Study) => (
										<li class="about-studies-item">
											<div class="about-studies-item-title">
												{item.title}
											</div>
											<div class="about-studies-item-detail">
												{item.description}
											</div>
										</li>
									))}
								</ul>
							</div>
						)
					}
				</div>
			</section>

			<section id="contact" class="section">
				<div class="container">
					<h2 class="section-title">{t.contactTitle}</h2>
					<p class="section-text">{t.contactText}</p>

					<div class="contact-reveal-section">
						<div class="contact-reveal-item">
							<button
								class="contact-reveal-btn"
								data-contact="email"
							>
								<svg
									class="contact-icon"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
								>
									<path
										d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
									></path>
								</svg>
								<span class="contact-label"
									>{t.contactRevealEmail}</span
								>
							</button>
							<div
								class="contact-value"
								data-value="email"
								style="display: none;"
							>
								<a href={`mailto:${t.contactEmail}`}
									>{t.contactEmail}</a
								>
							</div>
						</div>

						<div class="contact-reveal-item">
							<button
								class="contact-reveal-btn"
								data-contact="phone"
							>
								<svg
									class="contact-icon"
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
								>
									<path
										d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"
									></path>
								</svg>
								<span class="contact-label"
									>{t.contactRevealPhone}</span
								>
							</button>
							<div
								class="contact-value"
								data-value="phone"
								style="display: none;"
							>
								<a href={`tel:${t.contactPhone}`}
									>{t.contactPhone}</a
								>
							</div>
						</div>
					</div>

					<div class="contact-social-section">
						<h3 class="contact-social-title">
							{t.contactSocialTitle}
						</h3>
						<div class="contact-social-icons">
							<a
								href="https://www.linkedin.com/in/adilie-seitmemetova-3a4196196/"
								target="_blank"
								rel="noopener noreferrer"
								class="social-icon-link"
								aria-label="LinkedIn"
							>
								<svg
									class="social-icon"
									viewBox="0 0 24 24"
									fill="currentColor"
								>
									<path
										d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
									></path>
								</svg>
							</a>
							<button
								class="social-icon-link"
								data-qr="whatsapp"
								aria-label="WhatsApp QR Code"
							>
								<svg
									class="social-icon"
									viewBox="0 0 24 24"
									fill="currentColor"
								>
									<path
										d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"
									></path>
								</svg>
							</button>
							<button
								class="social-icon-link"
								data-qr="telegram"
								aria-label="Telegram QR Code"
							>
								<svg
									class="social-icon"
									viewBox="0 0 24 24"
									fill="currentColor"
								>
									<path
										d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"
									></path>
								</svg>
							</button>
						</div>
					</div>
				</div>

				<!-- QR Code Modals -->
				<div id="qr-modal" class="qr-modal" style="display: none;">
					<div class="qr-modal-overlay"></div>
					<div class="qr-modal-content">
						<button class="qr-modal-close" aria-label="Close">
							<svg
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
							>
								<path d="M18 6L6 18M6 6l12 12"></path>
							</svg>
						</button>
						<div class="qr-modal-body">
							<img id="qr-image" src="" alt="QR Code" />
							<p id="qr-title"></p>
						</div>
					</div>
				</div>
			</section>

			{t.cvLink && (
				<section id="cv" class="section section-alt cv-section">
					<div class="container cv-inner">
						<div class="cv-copy">
							<h2 class="section-title">{t.cvTitle}</h2>
							{t.cvText && <p class="section-text">{t.cvText}</p>}
						</div>
						<a class="btn primary" href={t.cvLink} download>
							{t.cvButtonLabel}
						</a>
					</div>
				</section>
			)}
		</main>

		<script is:inline define:vars={{ t }}>
			// Contact reveal functionality
			document.addEventListener("DOMContentLoaded", () => {
				const revealButtons = document.querySelectorAll(
					".contact-reveal-btn",
				);

				revealButtons.forEach((button) => {
					button.addEventListener("click", () => {
						const contactType = button.getAttribute("data-contact");
						const valueDiv = document.querySelector(
							`[data-value="${contactType}"]`,
						);
						const label = button.querySelector(".contact-label");

						if (valueDiv.style.display === "none") {
							valueDiv.style.display = "block";
							button.style.display = "none";
						}
					});
				});

				// QR Code modal functionality
				const qrButtons = document.querySelectorAll("[data-qr]");
				const modal = document.getElementById("qr-modal");
				const modalOverlay = modal.querySelector(".qr-modal-overlay");
				const closeBtn = modal.querySelector(".qr-modal-close");
				const qrImage = document.getElementById("qr-image");
				const qrTitle = document.getElementById("qr-title");

				qrButtons.forEach((button) => {
					button.addEventListener("click", () => {
						const qrType = button.getAttribute("data-qr");

						if (qrType === "whatsapp") {
							qrImage.src = "/images/whatsapp-qr.png";
							qrTitle.textContent = t.qrModalTitleWhatsapp;
						} else if (qrType === "telegram") {
							qrImage.src = "/images/telegram-qr.jpg";
							qrTitle.textContent = t.qrModalTitleTelegram;
						}

						modal.style.display = "flex";
						document.body.style.overflow = "hidden";
					});
				});

				const closeModal = () => {
					modal.style.display = "none";
					document.body.style.overflow = "";
				};

				closeBtn.addEventListener("click", closeModal);
				modalOverlay.addEventListener("click", closeModal);

				// Close modal on Escape key
				document.addEventListener("keydown", (e) => {
					if (e.key === "Escape" && modal.style.display === "flex") {
						closeModal();
					}
				});
			});
		</script>
	</body>
</html>
